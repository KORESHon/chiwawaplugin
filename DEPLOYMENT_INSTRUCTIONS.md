# Инструкции по развёртыванию обновлённого плагина

## Проблема
Пользователь не может авторизоваться на Minecraft сервере с сообщением "Недействительный токен", хотя игровой токен сгенерирован корректно.

## Причина
Плагин использовал устаревший API токен в config.yml, что блокировало проверку игровых токенов через API.

## Решение
1. **Создан новый долгосрочный API токен** для плагина:
   ```
   ID: 3
   Токен: b834fa18492e3957f8fbd841a6403be9adedd466dcaa0595b45d5fcc1339df14e975e53362d9a92e722c32c56cc786f64bcecfa89cecd7c735a3f931140cf369
   Префикс: b834fa18...
   Права: server:status, players:read, players:update, sessions:manage, stats:update
   Создан: 05.08.2025 15:09:32
   ```

2. **Обновлена конфигурация плагина** с новым токеном
3. **Пересобран плагин** с обновлённой конфигурацией

## Развёртывание

### Шаг 1: Остановка сервера
```bash
# Остановите Minecraft сервер
/stop
```

### Шаг 2: Замена плагина
```bash
# Скопируйте новый jar файл в папку plugins сервера
cp target/ChiwawaPlugin-1.0-SNAPSHOT.jar /path/to/minecraft/server/plugins/
```

### Шаг 3: Запуск сервера
```bash
# Запустите сервер заново
java -jar server.jar
```

### Альтернативный способ (горячая перезагрузка)
Если ваш сервер поддерживает горячую перезагрузку плагинов:
```
/reload confirm
# или
/plugman reload ChiwawaPlugin
```

## Проверка работоспособности

### 1. Генерация игрового токена
На сайте выполните генерацию нового игрового токена:
- Откройте консоль разработчика (F12)
- Выполните: `generateGameToken()`
- Скопируйте полученный токен

### 2. Тест авторизации в игре
```
/login ВАШ_ТОКЕН
```

Должно появиться сообщение о успешной авторизации.

### 3. Проверка логов
Проверьте логи сервера на наличие ошибок подключения к API:
```
[ChiwawaPlugin] API connection successful
[ChiwawaPlugin] User authenticated successfully
```

## Отладка проблем

### Если авторизация всё ещё не работает:

1. **Проверьте работу веб-сайта:**
   ```bash
   curl -X POST http://localhost:3000/api/auth/verify-game-token \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer b834fa18492e3957f8fbd841a6403be9adedd466dcaa0595b45d5fcc1339df14e975e53362d9a92e722c32c56cc786f64bcecfa89cecd7c735a3f931140cf369" \
        -d '{"token":"ВАШ_ИГРОВОЙ_ТОКЕН"}'
   ```

2. **Проверьте конфигурацию плагина в игре:**
   ```
   /chiwawa debug config
   ```

3. **Проверьте статус API соединения:**
   ```
   /chiwawa debug api
   ```

## Технические детали

### Поток авторизации:
1. Пользователь генерирует игровой токен на сайте (срок действия 15 минут)
2. Выполняет команду `/login ТОКЕН` в игре
3. Плагин отправляет запрос к API с игровым токеном и своим API ключом
4. API проверяет игровой токен и возвращает данные пользователя
5. Плагин сохраняет сессию и уведомляет пользователя об успешной авторизации

### Используемые токены:
- **Игровые токены**: 15-минутные токены для авторизации в Minecraft
- **API токены**: Долгосрочные токены для аутентификации плагина с API
- **Web JWT токены**: Сессионные токены для веб-интерфейса

### Файлы изменены:
- `src/main/resources/config.yml` - обновлён API ключ
- `target/ChiwawaPlugin-1.0-SNAPSHOT.jar` - пересобран с новой конфигурацией

## Файлы проекта

### Обновлённый плагин:
- **Местоположение**: `z:\!Others\chiwawaplugin\target\ChiwawaPlugin-1.0-SNAPSHOT.jar`
- **Размер**: ~2MB (включает все зависимости)
- **Версия**: 1.0-SNAPSHOT
- **Дата сборки**: 05.08.2025 18:11:20

### Конфигурация:
- **API URL**: http://localhost:3000/api
- **Таймаут**: 5000ms
- **Количество попыток**: 3
- **API ключ**: Обновлён на новый долгосрочный токен
